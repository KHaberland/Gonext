# PLAN.md — План реализации GoNext

Поэтапный порядок действий по реализации приложения на основании [PROJECT.md](PROJECT.md).

---

## Этап 1. Инициализация проекта

1.1. Создать проект Expo (React Native) с шаблоном под Expo Router.  
1.2. Установить и настроить зависимости:
   - React Native Paper (UI)
   - SQLite (expo-sqlite или react-native-quick-sqlite для локальной БД)
   - При необходимости: пакеты для работы с файлами (expo-file-system), аудио (expo-av), камерой/галереей (expo-image-picker)
1.3. Настроить структуру папок: `app/` (маршруты), `components/`, `lib/` (БД, хелперы), `types/`.

---

## Этап 2. Схема данных и слой работы с БД

2.1. Описать TypeScript-типы сущностей: `Place`, `Trip`, `TripPlace`, `Recording`.  
2.2. Спроектировать и создать таблицы SQLite:
   - `places` (id, name, description, visit_later, liked, lat, lon, created_at)
   - `trips` (id, title, description, start_date, end_date, current, created_at)
   - `trip_places` (id, trip_id, place_id, `order`, visited, visit_date, notes)
   - `place_photos` (id, place_id, file_uri) — для мест в режиме «Места»
   - `trip_place_photos` (id, trip_place_id, file_uri)
   - `recordings` (id, audio_uri, transcribed_text, created_at, place_id NULLABLE, trip_place_id NULLABLE)
2.3. Реализовать слой доступа к БД: инициализация при старте, CRUD для каждой сущности, получение мест по поездке, получение записей по place_id / trip_place_id.

---

## Этап 3. Навигация и главный экран

3.1. Настроить Expo Router: корневой layout, главный экран (index).  
3.2. Реализовать главный экран с кнопками: Места, Поездки, Следующее место, Настройки.  
3.3. Создать заглушки экранов и маршруты: `places`, `places/[id]`, `trips`, `trips/[id]`, `next-place`, `settings`.

---

## Этап 4. Режим «Места»

4.1. Экран списка мест: загрузка из БД, отображение списка (React Native Paper List и т.п.), кнопка «Добавить место».  
4.2. Экран добавления/редактирования места: название, описание, координаты (ввод или выбор на карте), флаги visitLater/liked, сохранение в БД.  
4.3. Детальная карточка места: показ данных, кнопки «На карте», «Добавить фото», «Голосовая запись» (переход к диктофону — см. этап 8).  
4.4. Привязка фотографий: выбор из галереи/камеры (expo-image-picker), сохранение файлов в директорию приложения, запись путей в `place_photos`.  
4.5. Открытие места на карте: интеграция карты (например, react-native-maps) и отображение метки по координатам места.

---

## Этап 5. Режим «Поездки»

5.1. Экран списка поездок: загрузка из БД, кнопка «Создать поездку».  
5.2. Создание/редактирование поездки: название, описание, даты начала/окончания, признак «текущая», сохранение.  
5.3. Экран деталей поездки (маршрут): упорядоченный список мест (TripPlace), кнопки «Добавить место» (из списка мест или новое), изменение порядка (drag-and-drop или стрелки).  
5.4. Для каждого места в маршруте: отметка «Посещено», дата визита, поле заметок, добавление фото (сохранение в `trip_place_photos`), кнопка голосовой записи.  
5.5. Реализовать отображение поездки в двух видах: план (все места) и дневник (акцент на посещённых с заметками и медиа).

---

## Этап 6. Режим «Следующее место»

6.1. Реализовать логику выбора следующего места: активная поездка (`current = true`) → первое место с `visited = false`.  
6.2. Экран «Следующее место»: вывод названия, описания, координат; кнопки «Открыть на карте» и «Открыть в навигаторе» (Linking с geo-URL или intent для навигационного приложения).

---

## Этап 7. Карта и навигатор

7.1. Подключить офлайн-карту или кэширование тайлов (в соответствии с выбранной библиотекой карт), чтобы работа без интернета была возможна.  
7.2. Реализовать открытие места на карте по координатам (из экрана места и из «Следующее место»).  
7.3. Реализовать открытие в внешнем навигаторе (Google Maps / Apple Maps / системный выбор) по координатам.

---

## Этап 8. Диктофон (запись и воспроизведение)

8.1. Запросить разрешения на запись аудио (Permissions API Expo).  
8.2. Реализовать запись: запись в файл (expo-av или нативный модуль), сохранение файла в директорию приложения (expo-file-system), получение `audioUri`.  
8.3. Создать сущность Recording в БД: при сохранении записи создавать строку в `recordings` с `audio_uri`, `created_at` и привязкой к `place_id` или `trip_place_id`.  
8.4. Реализовать воспроизведение: список записей в карточке места/точки маршрута, воспроизведение по нажатию (expo-av).  
8.5. Добавить UI записи в экран места (режим «Места») и в экран точки маршрута (режим «Поездки»).

---

## Этап 9. Транскрипция (офлайн)

9.1. Выбрать офлайн-решение для распознавания речи:
   - вариант A: платформенные API (Apple Speech, Android SpeechRecognizer с офлайн-пакетами) через нативные модули или готовую библиотеку;
   - вариант B: встраиваемая модель (например, Vosk, whisper.cpp) в виде нативного модуля или JS-биндинга.
9.2. Реализовать вызов транскрипции: по нажатию «Транскрибировать» передавать `audioUri` в выбранный движок, получать текст.  
9.3. Сохранять результат в поле `transcribed_text` записи в БД и отображать в UI (в карточке записи).

---

## Этап 10. Настройки и финализация

10.1. Экран «Настройки»: минимальный набор (например, выбор текущей поездки, о приложении).  
10.2. Проверка офлайн-сценариев: запуск без сети, карта, БД, диктофон, транскрипция.  
10.3. Обработка ошибок и краевых случаев (нет текущей поездки, нет следующего места, отказ в разрешениях).  
10.4. Сборка под Android и iOS, проверка на реальных устройствах.

---

## Порядок этапов (кратко)

| № | Этап |
|---|------|
| 1 | Инициализация проекта, зависимости, структура папок |
| 2 | Схема БД и слой доступа к данным |
| 3 | Навигация и главный экран |
| 4 | Режим «Места» (список, карточка, фото, карта) |
| 5 | Режим «Поездки» (список, маршрут, посещения, заметки, фото) |
| 6 | Режим «Следующее место» |
| 7 | Карта и открытие в навигаторе |
| 8 | Диктофон (запись, сохранение, воспроизведение) |
| 9 | Офлайн-транскрипция |
| 10 | Настройки и финальная проверка |

Данный порядок обеспечивает: сначала фундамент (проект, БД, навигация), затем основные режимы, затем медиа (фото, карта, диктофон) и в конце — опциональную транскрипцию и полировку.
